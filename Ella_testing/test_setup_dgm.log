
. siman which
C:\ian\git\siman\siman.ado
*!version 0.9  14jun2024
C:\ian\git\siman\siman_setup.ado
*!      version 0.10.2  14jun2024       
C:\ian\git\siman\siman_describe.ado
*! version 0.7  14jun2024       IW streamline for longlong only; calculate #dgms without assuming fa
> ctorial; remove commented out code
C:\ian\git\siman\siman_analyse.ado
*! version 0.9.1        14jun2024               IW remove code for nformat!=1 and nmethod!=1
C:\ian\git\siman\siman_table.ado
*! version 0.8.3   3apr2024
C:\ian\git\siman\siman_lollyplot.ado
*! version 1.13.2  15dec2023
C:\ian\git\siman\siman_zipplot.ado
*!  version 1.9 22apr2024
C:\ian\git\siman\siman_comparemethodsscatter.ado
*! version 1.9.19 2may2024
C:\ian\git\siman\siman_blandaltman.ado
*!  version 1.7 22apr2024
C:\ian\git\siman\siman_swarm.ado
*! version 1.10 22apr2024
C:\ian\git\siman\siman_scatter.ado
*!      version 0.10    18jun2024       IW Clean up handling of varlist, if/in, by
C:\ian\git\siman\siman_nestloop.ado
*! version 1.8.2   17aug2023

. 
. forvalues dgmtype = 1/5 {
  2.         di as input "dgmtype = `dgmtype'"
  3.         use c:\temp\extendedtestdata, clear
  4.         keep if method=="CCA"
  5.         drop method
  6.         if `dgmtype'==1 {
  7.                 keep if beta==1 & pmiss==1 & mech=="MCAR"
  8.                 drop beta pmiss mech
  9.                 local dgmopt
 10.                 local xdgm 
 11.                 local xndgmvars 0
 12.         }
 13.         if `dgmtype'==2 {
 14.                 keep if beta==1 & pmiss==1 & mech=="MCAR"
 15.                 drop pmiss mech 
 16.                 local dgmopt dgm(beta)
 17.                 local xdgm beta
 18.                 local xndgmvars 1
 19.         }
 20.         if `dgmtype'==3 {
 21.                 keep if beta==1 & pmiss==1 
 22.                 drop beta pmiss
 23.                 local dgmopt dgm(mech)
 24.                 local xdgm mech
 25.                 local xndgmvars 1
 26.         }
 27.         if `dgmtype'==4 {
 28.                 keep if beta==1
 29.                 drop beta
 30.                 local dgmopt dgm(pmiss mech)
 31.                 local xdgm pmiss mech
 32.                 local xndgmvars 2
 33.         }
 34.         if `dgmtype'==5 {
 35.                 local dgmopt dgm(beta pmiss mech)
 36.                 local xdgm beta pmiss mech
 37.                 local xndgmvars 3
 38.         }
 39.         qui siman setup, rep(re) `dgmopt' target(estim) estimate(b) se(se) true(truev)
 40.         foreach thing in dgm ndgmvars {
 41.                 local xx `: char _dta[siman_`thing']'
 42.                 cap assert "`x`thing''" == "`xx'"
 43.                 if _rc {
 44.                         di as error "Error with dgmtype = `dgmtype':"
 45.                         di "_dta[siman_`thing'] = `xx' but should be `x`thing''"
 46.                 }
 47.         }
 48.         
.         * save for testing siman graph commands
.         save data/setupdata_dgm`dgmtype', replace
 49. 
.         qui count if estimand=="effect"
 50.         local x = r(N)
 51.         siman analyse if estimand=="mean1", notable
 52.         qui count if estimand=="effect"
 53.         assert `x' == r(N)
 54.         siman analyse if estimand=="mean0", notable replace
 55.         qui count if estimand=="effect"
 56.         assert `x' == r(N)
 57. }
dgmtype = 1
(72,000 observations deleted)
(33,000 observations deleted)
file data/setupdata_dgm1.dta saved
siman analyse has run successfully
siman analyse has run successfully
dgmtype = 2
(72,000 observations deleted)
(33,000 observations deleted)
file data/setupdata_dgm2.dta saved
siman analyse has run successfully
siman analyse has run successfully
dgmtype = 3
(72,000 observations deleted)
(30,000 observations deleted)
file data/setupdata_dgm3.dta saved
siman analyse has run successfully
siman analyse has run successfully
dgmtype = 4
(72,000 observations deleted)
(24,000 observations deleted)
file data/setupdata_dgm4.dta saved
siman analyse has run successfully
siman analyse has run successfully
dgmtype = 5
(72,000 observations deleted)
file data/setupdata_dgm5.dta saved
siman analyse has run successfully
siman analyse has run successfully

. 
. di as result "*** SIMAN HAS PASSED ALL THE TESTS IN `filename'.do ***"
*** SIMAN HAS PASSED ALL THE TESTS IN test_setup_dgm.do ***

. 
. log close
