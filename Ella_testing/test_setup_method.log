
. siman which
C:\ian\git\siman\siman.ado
*!      version 0.11    07oct2024
*!      Type -siman which- to see versions of siman's subprograms
C:\ian\git\siman\siman_setup.ado
*!      version 0.11    09oct2024       
C:\ian\git\siman\siman_describe.ado
*!      version 0.7     14jun2024       
C:\ian\git\siman\siman_analyse.ado
*!      version 0.9.1   14jun2024               
C:\ian\git\siman\siman_table.ado
*!      version 0.8.3   3apr2024
C:\ian\git\siman\siman_lollyplot.ado
*!      version 0.10.2  19aug2024       
*!      version 0.10.2  19aug2024       IW add undocumented nodgmtitle option
C:\ian\git\siman\siman_zipplot.ado
*!      version 0.10    19jul2024
C:\ian\git\siman\siman_comparemethodsscatter.ado
*!      version 0.10.1  8aug2024        
C:\ian\git\siman\siman_blandaltman.ado
*!      version 0.10    24jun2024
C:\ian\git\siman\siman_swarm.ado
*!      version 0.10    19jul2024
C:\ian\git\siman\siman_scatter.ado
*!      version 0.10    18jun2024       
C:\ian\git\siman\siman_nestloop.ado
*!      version 0.10.1  26jun2024       

. 
. forvalues methodtype = 1/6 {
  2.         di as input "methodtype = `methodtype'"
  3.         use data/extendedtestdata, clear
  4.         keep if float(pmiss)==float(0.2) & estimand=="effect"
  5.         drop pmiss estimand
  6.         if `methodtype'==1 { // no method var
  7.                 keep if method=="CCA"
  8.                 drop method
  9.                 local methodopt
 10.                 * x* locals are correct values against which to test chars
.                 local xmethod _method
 11.                 local xmethodcreated 1
 12.                 local xmethodnature 0
 13.                 local xmethodvalues 1
 14.                 local xnummethod 1
 15.                 local xvalmethod 1
 16.         }
 17.         if `methodtype'==2 { // 1 method, string
 18.                 keep if method=="CCA"
 19.                 local methodopt method(method)
 20. 
.                 local xmethod method
 21.                 local xmethodcreated 0
 22.                 local xmethodnature 2
 23.                 local xmethodvalues CCA
 24.                 local xnummethod 1
 25.                 local xvalmethod CCA
 26.         }
 27.         if `methodtype'==3 { // 3 methods, string
 28.                 local methodopt method(method)
 29. 
.                 local xmethod method
 30.                 local xmethodcreated 0
 31.                 local xmethodnature 2
 32.                 local xmethodvalues CCA MeanImp Noadj
 33.                 local xnummethod 3
 34.                 local xvalmethod CCA MeanImp Noadj
 35.         }
 36.         if `methodtype'==4 { // 3 methods, num-labelled
 37.                 sencode method, gsort(method) replace
 38.                 local methodopt method(method)
 39.         
.                 local xmethod method
 40.                 local xmethodcreated 0
 41.                 local xmethodnature 1
 42.                 local xmethodvalues 1 2 3
 43.                 local xnummethod 3
 44.                 local xvalmethod CCA MeanImp Noadj
 45.         }
 46.         if `methodtype'==5 { // 3 methods, numeric, wide
 47.                 sencode method, gsort(method) replace
 48.                 qui reshape wide b se, i(rep beta mech true) j(method)
 49.                 char _dta[__JValLab] // needed to stop Stata remembering method names
 50.                 local methodopt method(1 2 3)
 51. 
.                 local xmethod method
 52.                 local xmethodcreated 0
 53.                 local xmethodnature 0
 54.                 local xmethodvalues 1 2 3
 55.                 local xnummethod 3
 56.                 local xvalmethod 1 2 3
 57.         }
 58.         if `methodtype'==6 { // 3 methods, string, wide
 59.                 qui reshape wide b se, i(rep beta mech true) j(method) string
 60.                 local methodopt method(CCA MeanImp Noadj)
 61. 
.                 local xmethod method
 62.                 local xmethodcreated 0
 63.                 local xmethodnature 1
 64.                 local xmethodvalues 1 2 3
 65.                 local xnummethod 3
 66.                 local xvalmethod CCA MeanImp Noadj
 67.         }
 68.         qui siman setup, rep(re) dgm(beta mech) `methodopt' estimate(b) se(se) true(true)
 69.         foreach thing in method methodcreated methodnature methodvalues nummethod valmethod {
 70.                 local xx `: char _dta[siman_`thing']'
 71.                 cap assert "`x`thing''" == "`xx'"
 72.                 if _rc {
 73.                         di as error "Error with methodtype = `methodtype':"
 74.                         di "_dta[siman_`thing'] = `xx' but should be `x`thing''"
 75.                 }
 76.         }
 77. 
.         * save for testing siman graph commands
.         save data/setupdata_method`methodtype', replace
 78. 
.         qui count if float(beta)==float(0.5)
 79.         local x = r(N)
 80.         siman analyse if float(beta)==float(0.25), notable
 81.         qui count if float(beta)==float(0.5)
 82.         assert `x' == r(N)
 83.         siman analyse if float(beta)==float(0), notable replace
 84.         qui count if float(beta)==float(0.5)
 85.         assert `x' == r(N)
 86. }
methodtype = 1
(90,000 observations deleted)
(12,000 observations deleted)
file data/setupdata_method1.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 2
(90,000 observations deleted)
(12,000 observations deleted)
file data/setupdata_method2.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 3
(90,000 observations deleted)
file data/setupdata_method3.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 4
(90,000 observations deleted)
file data/setupdata_method4.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 5
(90,000 observations deleted)
file data/setupdata_method5.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 6
(90,000 observations deleted)
file data/setupdata_method6.dta saved
siman analyse has run successfully
siman analyse has run successfully

. 
. di as result "*** SIMAN HAS PASSED ALL THE TESTS IN `filename'.do ***"
*** SIMAN HAS PASSED ALL THE TESTS IN test_setup_method.do ***

. 
. log close
