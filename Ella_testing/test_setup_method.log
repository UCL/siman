
. siman which
C:\ian\git\siman\siman.ado
*!version 0.9  14jun2024
C:\ian\git\siman\siman_setup.ado
*!      version 0.10.2  14jun2024       
C:\ian\git\siman\siman_describe.ado
*! version 0.7  14jun2024       IW streamline for longlong only; calculate #dgms without assuming fa
> ctorial; remove commented out code
C:\ian\git\siman\siman_analyse.ado
*! version 0.9.1        14jun2024               IW remove code for nformat!=1 and nmethod!=1
C:\ian\git\siman\siman_table.ado
*! version 0.8.3   3apr2024
C:\ian\git\siman\siman_lollyplot.ado
*! version 1.13.2  15dec2023
C:\ian\git\siman\siman_zipplot.ado
*!  version 1.9 22apr2024
C:\ian\git\siman\siman_comparemethodsscatter.ado
*! version 1.9.19 2may2024
C:\ian\git\siman\siman_blandaltman.ado
*!  version 1.7 22apr2024
C:\ian\git\siman\siman_swarm.ado
*! version 1.10 22apr2024
C:\ian\git\siman\siman_scatter.ado
*! version 1.7 22apr2024
C:\ian\git\siman\siman_nestloop.ado
*! version 1.8.2   17aug2023

. 
. forvalues methodtype = 1/6 {
  2.         di as input "methodtype = `methodtype'"
  3.         use c:\temp\extendedtestdata, clear
  4.         if `methodtype'==1 { // no method var
  5.                 keep if method=="CCA"
  6.                 drop method
  7.                 local methodopt
  8.                 * x* locals are correct values against which to test chars
.                 local xmethod _method
  9.                 local xmethodcreated 1
 10.                 local xmethodnature 0
 11.                 local xmethodvalues 1
 12.                 local xnummethod 1
 13.                 local xvalmethod 1
 14.         }
 15.         if `methodtype'==2 { // 1 method, string
 16.                 keep if method=="CCA"
 17.                 local methodopt method(method)
 18. 
.                 local xmethod method
 19.                 local xmethodcreated 0
 20.                 local xmethodnature 2
 21.                 local xmethodvalues CCA
 22.                 local xnummethod 1
 23.                 local xvalmethod CCA
 24.         }
 25.         if `methodtype'==3 { // 3 methods, string
 26.                 local methodopt method(method)
 27. 
.                 local xmethod method
 28.                 local xmethodcreated 0
 29.                 local xmethodnature 2
 30.                 local xmethodvalues CCA MeanImp Noadj
 31.                 local xnummethod 3
 32.                 local xvalmethod CCA MeanImp Noadj
 33.         }
 34.         if `methodtype'==4 { // 3 methods, num-labelled
 35.                 sencode method, gsort(method) replace
 36.                 local methodopt method(method)
 37.         
.                 local xmethod method
 38.                 local xmethodcreated 0
 39.                 local xmethodnature 1
 40.                 local xmethodvalues 1 2 3
 41.                 local xnummethod 3
 42.                 local xvalmethod CCA MeanImp Noadj
 43.         }
 44.         if `methodtype'==5 { // 3 methods, numeric, wide
 45.                 sencode method, gsort(method) replace
 46.                 qui reshape wide b se, i(rep beta pmiss mech estimand truevalue) j(method)
 47.                 char _dta[__JValLab] // needed to stop Stata remembering method names
 48.                 local methodopt method(1 2 3)
 49. 
.                 local xmethod method
 50.                 local xmethodcreated 0
 51.                 local xmethodnature 0
 52.                 local xmethodvalues 1 2 3
 53.                 local xnummethod 3
 54.                 local xvalmethod 1 2 3
 55.         }
 56.         if `methodtype'==6 { // 3 methods, string, wide
 57.                 qui reshape wide b se, i(rep beta pmiss mech estimand truevalue) j(method) stri
> ng
 58.                 local methodopt method(CCA MeanImp Noadj)
 59. 
.                 local xmethod method
 60.                 local xmethodcreated 0
 61.                 local xmethodnature 1
 62.                 local xmethodvalues 1 2 3
 63.                 local xnummethod 3
 64.                 local xvalmethod CCA MeanImp Noadj
 65.         }
 66.         qui siman setup, rep(re) dgm(beta pmiss mech) target(estima) `methodopt' estimate(b) se
> (se) true(truevalue)
 67.         foreach thing in method methodcreated methodnature methodvalues nummethod valmethod {
 68.                 local xx `: char _dta[siman_`thing']'
 69.                 cap assert "`x`thing''" == "`xx'"
 70.                 if _rc {
 71.                         di as error "Error with methodtype = `methodtype':"
 72.                         di "_dta[siman_`thing'] = `xx' but should be `x`thing''"
 73.                 }
 74.         }
 75. 
.         * save for testing siman graph commands
.         save data/setupdata_method`methodtype', replace
 76. 
.         qui count if beta==3
 77.         local x = r(N)
 78.         siman analyse if beta==2, notable
 79.         qui count if beta==3
 80.         assert `x' == r(N)
 81.         siman analyse if beta==1, notable replace
 82.         qui count if beta==3
 83.         assert `x' == r(N)
 84. }
methodtype = 1
(72,000 observations deleted)
file data/setupdata_method1.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 2
(72,000 observations deleted)
file data/setupdata_method2.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 3
file data/setupdata_method3.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 4
file data/setupdata_method4.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 5
file data/setupdata_method5.dta saved
siman analyse has run successfully
siman analyse has run successfully
methodtype = 6
file data/setupdata_method6.dta saved
siman analyse has run successfully
siman analyse has run successfully

. 
. di as result "*** SIMAN HAS PASSED ALL THE TESTS IN `filename'.do ***"
*** SIMAN HAS PASSED ALL THE TESTS IN test_setup_method.do ***

. 
. log close
